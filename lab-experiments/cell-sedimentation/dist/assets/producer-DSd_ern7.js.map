{"version":3,"file":"producer-DSd_ern7.js","sources":["../src/ts/rk45.ts","../src/ts/calcs.ts","../src/ts/Workers/baseWorker.ts","../src/ts/Workers/producer.ts"],"sourcesContent":["// Adaptive RK45 ODE solver for systems of equations\n// --------------------------------------------------\n\nexport type ODEFunc = (t: number, y: number[]) => number[];\n\nexport interface RK45Result {\n  t: number[];\n  y: number[][];\n}\n\nexport interface RK45Options {\n  dt?: number;         // initial step size\n  atol?: number;       // absolute tolerance\n  rtol?: number;       // relative tolerance\n  dtMin?: number;      // minimum step size\n  dtMax?: number;      // maximum step size\n  safety?: number;     // safety factor for adaptive step\n  verbose?: boolean;  // enable verbose logging\n  onUnderflow? : () => void; // callback on step size underflow\n}\n\n/**\n * Integrate dy/dt = f(t, y) from t0 to tEnd using adaptive RK45 (Dormand-Prince).\n * @param f rhs for dyi/dt = f(t, y)\n * @param y0 initial values for y\n * @param t0 initial time\n * @param tEnd final time to end integration\n * @param opts additional options for solver\n * @returns object containing solution { t, y } where y is an array containing each yi array to be matched with t array\n */\nexport function rk45_dormand_prince(\n  f: ODEFunc,\n  y0: number[],\n  t0: number,\n  tEnd: number,\n  opts: RK45Options = {}\n): RK45Result {\n  const {\n    dt = (tEnd - t0) / 1000,\n    atol = 1e-6,\n    rtol = 1e-3,\n    dtMin = 1e-8,\n    dtMax = Math.abs(tEnd - t0) / 5,\n    safety = 0.9,\n    verbose = false,\n  } = opts;\n\n  // Dormand-Prince coefficients\n  // c_i values (nodes)\n  const c2 = 1/5, c3 = 3/10, c4 = 4/5, c5 = 8/9, c6 = 1, c7 = 1;\n\n  // a_ij values (Runge-Kutta matrix)\n  const a21 = 1/5;\n  const a31 = 3/40, a32 = 9/40;\n  const a41 = 44/45, a42 = -56/15, a43 = 32/9;\n  const a51 = 19372/6561, a52 = -25360/2187, a53 = 64448/6561, a54 = -212/729;\n  const a61 = 9017/3168, a62 = -355/33, a63 = 46732/5247, a64 = 49/176, a65 = -5103/18656;\n  const a71 = 35/384, a72 = 0, a73 = 500/1113, a74 = 125/192, a75 = -2187/6784, a76 = 11/84;\n\n  // b_i values (5th order solution weights)\n  const b1 = 35/384, b3 = 500/1113, b4 = 125/192, b5 = -2187/6784, b6 = 11/84, b7 = 0;\n  \n  // b*_i values (4th order solution weights for error estimation)\n  const bs1 = 5179/57600, bs3 = 7571/16695, bs4 = 393/640, bs5 = -92097/339200, bs6 = 187/2100, bs7 = 1/40;\n\n  let t = t0;\n  let y = y0.slice();\n  let h = dt;\n  let err = 1;\n\n  const tVals = [t];\n  const yVals =  [y.slice()];\n  // FSAL support: store k1 for reuse between attempts/steps. When a step is\n  // accepted we will set `last_k1` to the computed k7 so it can be reused as\n  // the k1 of the next step.\n  let last_k1: number[] | null = null;\n\n  while (t < tEnd) {\n    // if (t > .13517) {\n    //   let debug = 1;\n    // }\n    if (h !== h) {\n      throw new Error(\"NaN encountered in h\");\n    }\n    if (t + h > tEnd) h = tEnd - t;\n\n    try {\n      // Compute Runge-Kutta stages (FSAL): reuse last_k1 when available,\n      // otherwise compute k1 and keep it so retries don't recompute it.\n      let k1: number[];\n      if (last_k1) {\n        k1 = last_k1;\n      } else {\n        k1 = f(t, y.slice());\n        last_k1 = k1;\n      }\n      const k2 = f(t + c2 * h, y.map((yi, i) => yi + h * a21 * k1[i]));\n      const k3 = f(t + c3 * h, y.map((yi, i) => yi + h * (a31 * k1[i] + a32 * k2[i])));\n      const k4 = f(t + c4 * h, y.map((yi, i) => yi + h * (a41 * k1[i] + a42 * k2[i] + a43 * k3[i])));\n      const k5 = f(t + c5 * h, y.map((yi, i) => yi + h * (a51 * k1[i] + a52 * k2[i] + a53 * k3[i] + a54 * k4[i])));\n      const k6 = f(t + c6 * h, y.map((yi, i) => yi + h * (a61 * k1[i] + a62 * k2[i] + a63 * k3[i] + a64 * k4[i] + a65 * k5[i])));\n      const k7 = f(t + c7 * h, y.map((yi, i) => yi + h * (a71 * k1[i] + a72 * k2[i] + a73 * k3[i] + a74 * k4[i] + a75 * k5[i] + a76 * k6[i])));\n    \n      // 5th order solution\n      const y5 = y.map((yi, i) => yi + h * (b1 * k1[i] + b3 * k3[i] + b4 * k4[i] + b5 * k5[i] + b6 * k6[i] + b7 * k7[i]));\n      \n      // 4th order solution for error estimation\n      const y4 = y.map((yi, i) => yi + h * (bs1 * k1[i] + bs3 * k3[i] + bs4 * k4[i] + bs5 * k5[i] + bs6 * k6[i] + bs7 * k7[i]));\n\n      // Error estimate and tolerance check\n      const sqe = y.map((_, i) => Math.pow((y5[i] - y4[i]) / (atol + rtol * Math.max(Math.abs(y[i]), Math.abs(y5[i]))), 2));\n      const ssqe = sqe.reduce((a, b) => a + b, 0);\n      err = Math.sqrt(\n        ssqe / y.length\n      );\n\n      // Accept step if error small enough\n      if (err <= 1.0) {\n        t += h;\n        if (verbose) console.log(`[RK45] Accepted step to t=${t} with h=${h} (err=${err})`);\n        y = y5;\n        tVals.push(t);\n        yVals.push(y.slice());\n        // FSAL: reuse k7 as k1 for the next step (k7 is evaluated at t+h,\n        // y5 for Dormand-Prince, so it can serve as the next first stage).\n        last_k1 = k7.slice();\n      }\n\n      // Adapt timestep (using 5th order method)\n      const scale = safety * Math.pow(1.0 / Math.max(err, 1e-10), 0.2); // 1/(p+1) where p=4\n      if (scale !== scale) {\n        throw new Error(\"NaN encountered in h adaptation\");\n      }\n      h = Math.min(dtMax, h * Math.min(5, Math.max(0.2, scale)));\n    } \n    catch (e) {\n      if (verbose) {\n        console.error(\"Error computing RK45 stages at t =\", t, \"with h =\", h, \":\", e);\n      }\n      err = 2;\n      h = h * 0.5; // Reduce step size on error\n    }\n\n    if (h < dtMin && err > 1.0) {\n      if (opts.onUnderflow) {\n        opts.onUnderflow();\n      }\n      else {\n        throw new Error(\"Step size underflow â€” integration failed\");\n      }\n    }\n  }\n\n  return { t: tVals, y: yVals };\n}\n\nexport default rk45_dormand_prince;","import type { InitConc, Profile } from \"../types/globals\"\nimport rk45 from \"./rk45\"\n\nconst rho_f = 0.868 // Fluid density (g/cc)\nconst g = 981 // Gravitational acceleration (cm/s^2)\nconst mu = 2.15 // Fluid viscosity (mPa.s)\n\nconst rho_r = 1.08 // Red cell density (g/cc)\nconst d_r = 275e-4 // Red cell diameter (cm)\nconst rho_w = 1.00 // White cell density (g/cc)\nconst d_w = 550e-4 // White cell diameter (cm)\n\nexport const TUBE_LENGTH = 305; // mm\nexport const CONC_ARRAY_SIZE = 500; // points in finite element mesh\nexport const PROFILE_LENGTH = 2 * CONC_ARRAY_SIZE + 2; // Size for time, top, cr[500], and cw[500]\n\n/**\n * Convert volume fraction to number concentration (#/[l]^3) for particles of diameter dp units [l].\n * @param phi volume fraction of particle\n * @param dp diameter of particle\n */\nfunction concentration(phi: number, dp: number) {\n    return 6 * phi / (Math.PI * dp**3);\n}\n// Wrappers for more concise syntax\nexport const conc_r = (phi: number) => concentration(phi, d_r);\nexport const conc_w = (phi: number) => concentration(phi, d_w);\n\nconst cr_max = conc_r(1);\nconst cw_max = conc_w(1);\n\n/**\n * Convert concentration (#/cc) to volume fraction for particles of diameter dp (cm).\n * @param conc \n * @param dp \n * @returns \n */\nfunction volume_fraction(conc: number, dp: number) {\n    return conc * Math.PI * dp**3 / 6;\n}\n// Wrappers for more concise syntax\nexport const phi_r = (phi: number) => volume_fraction(phi, d_r);\nexport const phi_w = (phi: number) => volume_fraction(phi, d_w);\n\n/**\n * Calculate the settling velocity of an independant particle using Stokes' law.\n * @param d_p \n * @param rho_p \n * @returns \n */\nfunction settling_coeff_g(d_p: number, rho_p: number) {\n    const vs = (rho_p - rho_f) * g * d_p**2 / (18 * mu) // m/s\n    return vs * 1000 // Convert to mm/s\n}\n\n// Average void envelope thickness\nfunction d_Ep(r_conc: number, w_conc: number) {\n    if (r_conc + w_conc === 0) return 0;\n\n    const d_avg = (r_conc * d_r + w_conc * d_w)  / (r_conc + w_conc); // Average particle diameter\n    const ep = 1.0 - (r_conc + w_conc) * (1 - .4) // Typical packed bed void fraction for spheres\n    if (ep >= 1) return 0;\n\n    const pow = (1 - ep) ** (-1/3)\n    return d_avg * (pow - 1) // Void envelope thickness\n}\n\n// Calculate settling velocities\nconst Sr_g = settling_coeff_g(d_r, rho_r)\nconst Sw_g = settling_coeff_g(d_w, rho_w)\n\n// Calculate the effective settling velocity (mm/s) of a mixture of red and white cells.\nexport function particle_velocities(conc_r: number, conc_w: number) {\n    // Convert to volume fractions\n    const ph_r = volume_fraction(conc_r, d_r)\n    const ph_w = volume_fraction(conc_w, d_w)\n    if (ph_r + ph_w >= 1) return { red: 0, white: 0 } // Prevent unphysical concentrations\n    \n    const conc_f = 1 - ph_r - ph_w // volume fraction of fluid\n    const rho_susp = ph_r * rho_r + ph_w * rho_w + conc_f * rho_f // Suspension density (g/cc)\n    const d_ep = d_Ep(ph_r, ph_w) // Average void envelope thickness\n    const ep_r = (d_ep > 0) ? 1 - (1 + d_ep / d_r) ** -3 : 1; // Red cell porosity\n    const ep_w = (d_ep > 0) ? 1 - (1 + d_ep / d_w) ** -3 : 1; // White cell porosity\n    const vrs = Sr_g * (rho_r - rho_susp) / (rho_r - rho_f) * ep_r**4.6 // Red cells hindered settling\n    const vws = Sw_g * (rho_w - rho_susp) / (rho_w - rho_f) * ep_w**4.6 // White cells hindered settling\n    const vfc = -(ph_r * vrs + ph_w * vws) // Fluid counterflow\n    const vrc = vrs + vfc // Red cell velocity\n    const vwc = vws + vfc // White cell velocity\n    return { red: vrc, white:  vwc } // mm / s\n}\n\n/**\n * Calculate spatial derivative of 1D y mesh with x differential dx\n * @param y array of scalar values\n * @param dx spacing between y values\n * @returns dydx array\n */\nexport function grad(y: number[], dx: number) {\n    const len = y.length;\n    if (len < 2) return [0];\n\n    // Generate array and set edges\n    const dydx = new Array(len).fill(0);\n    dydx[0] = (y[1] - y[0]) / dx;\n    dydx[len-1] = (y[len-1] - y[len-2]) / dx;\n\n    // Calc middle derivs with 2nd order accuracy\n    for (let i=1; i<len-1; i++) {\n        const left = y[i-1];\n        const right= y[i+1];\n        dydx[i] = (right - left) / 2 / dx;\n    }\n    \n    return dydx;\n}\n\nexport function rhs_adv_diff(y: number[], dz: number): number[] {\n    // Unpack y\n    const cr = y.slice(0,CONC_ARRAY_SIZE); \n    const cw = y.slice(CONC_ARRAY_SIZE);\n\n    // Defensive checks\n    if (!Number.isFinite(dz) || dz <= 0) throw new Error(`rhs_adv_diff: bad dz=${dz}`);\n    for (let i = 0; i < y.length; i++) {\n        if (!Number.isFinite(y[i])) throw new Error(`rhs_adv_diff: non-finite y[${i}] = ${y[i]}`);\n    }\n\n    // BCs\n    cr[0] = 0; cw[0] = 0;\n    cr[CONC_ARRAY_SIZE - 1] = cr[CONC_ARRAY_SIZE - 2]; \n    cw[CONC_ARRAY_SIZE - 1] = cw[CONC_ARRAY_SIZE - 2];\n\n    // For advection term\n    const crvr = new Array(CONC_ARRAY_SIZE).fill(0);\n    const cwvw = new Array(CONC_ARRAY_SIZE).fill(0);\n    crvr[0] = 0;\n    cwvw[0] = 0;\n    for (let i=1;i<CONC_ARRAY_SIZE;i++) {\n        // Determine velocity\n        const { red, white } = particle_velocities(cr[i], cw[i]);\n        if (!Number.isFinite(red) || !Number.isFinite(white)) throw new Error(`particle_velocities returned non-finite at i=${i} cr=${cr[i]} cw=${cw[i]} red=${red} white=${white}`);\n        crvr[i] = cr[i] * red;\n        cwvw[i] = cw[i] * white;\n        if (crvr[i] !== crvr[i]) throw new Error(`crvr err: ${crvr}`)\n    }\n    crvr[CONC_ARRAY_SIZE-1] = 0;\n    cwvw[CONC_ARRAY_SIZE-1] = 0;\n\n    // Advection term\n    const adv_r = grad(crvr, dz);\n    const adv_w = grad(cwvw, dz);\n\n    // For diffusion term\n    const inner_dif_r = new Array(CONC_ARRAY_SIZE).fill(0);\n    const inner_dif_w = new Array(CONC_ARRAY_SIZE).fill(0);\n    inner_dif_r[0] = 5 * (cr[1] - cr[0]) / dz * (1 - cr[0] / cr_max)**10;\n    inner_dif_w[0] = 5 * (cw[1] - cw[0]) / dz * (1 - cw[0] / cw_max)**10;\n    for (let i=1;i<CONC_ARRAY_SIZE-1;i++) {\n        const dcri = (cr[i+1] - cr[i-1]) / 2 / dz;\n        const dcwi = (cw[i+1] - cw[i-1]) / 2 / dz;\n        inner_dif_r[i] = 5 * dcri * (1 - cr[i] / cr_max)**10;\n        inner_dif_w[i] = 5 * dcwi * (1 - cw[i] / cw_max)**10;\n        if (inner_dif_r[i] !== inner_dif_r[i]) throw new Error(`inner_dif_r err: ${inner_dif_r}`)\n    }\n    inner_dif_r[CONC_ARRAY_SIZE-1] = 5 * (cr[CONC_ARRAY_SIZE-1] - cr[CONC_ARRAY_SIZE-2]) / dz * (1 - cr[CONC_ARRAY_SIZE-1] / cr_max)**10;\n    inner_dif_w[CONC_ARRAY_SIZE-1] = 5 * (cw[CONC_ARRAY_SIZE-1] - cw[CONC_ARRAY_SIZE-2]) / dz * (1 - cw[CONC_ARRAY_SIZE-1] / cw_max)**10;\n\n    const dif_r = grad(inner_dif_r, dz);\n    const dif_w = grad(inner_dif_w, dz);\n    dif_r[0] = dif_r[CONC_ARRAY_SIZE-1] = 0;\n    dif_w[0] = dif_w[CONC_ARRAY_SIZE-1] = 0;\n\n    // Results \n    const drdt = new Array(CONC_ARRAY_SIZE).fill(0);\n    const dwdt = new Array(CONC_ARRAY_SIZE).fill(0);\n    drdt[0] = dwdt[0] = 0;\n    for (let i=1; i<CONC_ARRAY_SIZE-1;i++) {\n        drdt[i] = dif_r[i] - adv_r[i];\n        dwdt[i] = dif_w[i] - adv_w[i];\n    }\n    drdt[CONC_ARRAY_SIZE-1] = drdt[CONC_ARRAY_SIZE-2];\n    dwdt[CONC_ARRAY_SIZE-1] = dwdt[CONC_ARRAY_SIZE-2];\n\n    // console.log(drdt.map((dr,i) => (dr !== dr) ? i : 0).filter(e => e !== 0));\n    // console.log(drdt.slice(490));\n\n    return drdt.concat(dwdt);\n}\n\n/**\n * Convolve a 1D numpy array y with a moving average filter of given size.\n * Pads the edges with the first and last values in y to maintain size.\n * @param y array to smooth\n * @param window_size size of kernel\n * @returns smoothed array of same length as y\n */\nexport function movingAverageConvolve(y: number[], windowSize: number): number[] {\n  if (windowSize < 1) throw new Error(\"windowSize must be at least 1\");\n  if (windowSize === 1) return y;\n\n  const padWidth = Math.floor(windowSize / 2);\n  const n = y.length;\n\n  // Pad edges with the first and last values\n  const padded = [\n    ...Array(padWidth).fill(y[0]),\n    ...y,\n    ...Array(padWidth).fill(y[n - 1])\n  ];\n\n  // Precompute kernel weight\n  const norm = 1 / windowSize;\n\n  const smoothed: number[] = new Array(n);\n\n  // Perform convolution\n  for (let i = 0; i < n; i++) {\n    let sum = 0;\n    for (let j = 0; j < windowSize; j++) {\n      sum += padded[i + j];\n    }\n    smoothed[i] = sum * norm;\n  }\n\n  return smoothed;\n}\n\n/**\n * Linearly interpolate points in x to find corresponding points in y using xp and fp\n * @param x x coordinates of resulting points\n * @param xp x coordinates to interpolate between\n * @param fp values corresponding to original xp array\n * @returns f values corresponding to each x\n */\nexport function interp(x: number | number[], xp: number[], fp: number[]) {\n    if (!Array.isArray(x)) x = [x];\n    const f = x.map(xi => {\n        let nx = xp.length;\n        // Make sure we stay in the bounds\n        if (xi < xp[0]) {\n            console.warn(`interp point ${xi} out of min range for x array with min ${xp[0]}`);\n            return fp[0];\n        }\n\n        // Find the lo and hi indices\n        let lo=0, hi=1;\n        for (let j=0;j<nx;j++) {\n            if (xp[j] <= xi) lo = j;\n            else break;\n        }\n\n        // Interpolate results\n        if (lo === nx-1) {\n            return fp[nx-1];\n        }\n        hi = lo + 1;\n        const fi = fp[lo] + (fp[hi] - fp[lo]) * (xi - xp[lo]) / (xp[hi] - xp[lo]);\n        return fi;\n    });\n\n    return f;\n}\n\n/**\n * \n * @param y \n * @param z \n * @param lo \n * @param hi \n * @returns \n */\nexport function resize(y: number[], z: number[], lo: number) {\n    const cr = y.slice(0, CONC_ARRAY_SIZE);\n    const cw = y.slice(CONC_ARRAY_SIZE);\n\n    if (cr.length !== z.length || cw.length !== z.length) throw new Error(`y and z must have same length\\ncr:${cr.length}\\ncw:${cw.length}\\nz:${z.length}`);\n    const nz = cr.length;\n    const z_hi = z[nz - 1];\n    if (z_hi < 304.99) throw new Error(`z_hi = ${z_hi} which is a significant deviation from l=305 mm`);\n\n    // Determine where to start the new coordinate axis\n    let min_idx: number | undefined = undefined;\n    let sum = 0;\n    for (let i=0;i<cr.length;i++) {\n        const ph = cr[i] + cw[i];\n        sum += ph;\n        if (sum < lo) min_idx = i;\n        else if (sum >= 2*lo) break;\n    }\n    if (min_idx === undefined) return { y, z };\n\n    // Determine the new range and construct the new z array\n    const lz = z_hi - z[min_idx];\n    const z_new = Array.from({ length: nz }, (_,i) => i / (nz-1) * lz + z[min_idx]);\n\n    // Interpolate to get the new f(z) points in the array.\n    const cr_new = interp(z_new, z, cr);\n    const cw_new = interp(z_new, z, cw);\n\n    return { y: cr_new.concat(cw_new), z: z_new };\n}\n\n\nconst nz = CONC_ARRAY_SIZE;\nconst smooth_fsize = 11; // must be odd\nexport const SOLVER_TIMESTEP = 20;\nexport class ProfileSolver {\n    private current: number[];\n    private top = 0;\n    private t = 0;\n\n    constructor(xr0: number, xw0: number) {\n        // Prepare the initial profile\n        const cr0: number[] = new Array(nz).fill(conc_r(xr0));\n        const cw0: number[] = new Array(nz).fill(conc_w(xw0));\n        cr0[0] = cw0[0] = 0; // Free surface\n        this.current = cr0.concat(cw0);\n    }\n\n    // Spatial helpers\n    private lz = () => { return TUBE_LENGTH - this.top; }\n    private dz = () => { return this.lz() / (nz - 1); }\n    private create_z_arr = () => {\n        const dz = this.dz();\n        return Array.from({ length: nz }, (_,i) => i * dz + this.top);\n    }\n\n    // Rhs wrapper\n    private rhs = (_: number, y: number[]) => {\n        return rhs_adv_diff(y, this.dz());\n    };\n\n    /**\n     * Calculate one 20 second step for the profile\n     * @returns Results at time t + timestep\n     */\n    public calculate_step = () => {\n        const sol = rk45(this.rhs, this.current, 0, SOLVER_TIMESTEP, { rtol: 1e-4, atol: 1e-6 });\n\n        // Extract solution\n        let y_cur = sol.y.at(-1)!;\n        let cr_cur = y_cur.slice(0,nz);\n        let cw_cur = y_cur.slice(nz);\n\n        // Smooth\n        cr_cur = movingAverageConvolve(cr_cur, smooth_fsize);\n        cw_cur = movingAverageConvolve(cw_cur, smooth_fsize);\n        y_cur = cr_cur.concat(cw_cur);\n\n        // Resize\n        const resized = resize(y_cur, this.create_z_arr(), 5);\n        this.current = resized.y;\n        this.top = resized.z[0];\n        this.t += SOLVER_TIMESTEP;\n\n        // console.log(\"Solved to t=\", this.t)\n        const returnProf = new Float32Array([this.t, this.top].concat(this.current)) as Profile\n        for (let i=2;i<502;i++) {\n            returnProf[i] = phi_r(returnProf[i]);\n        }\n        for (let i=502;i<1002;i++) {\n            returnProf[i] = phi_w(returnProf[i]);\n        }\n        return returnProf;\n    }\n}\n\n\nexport const createProfile = (initConc: InitConc): Profile => {\n    // Initialize profile\n    const xr0 = initConc.xr0;\n    const xw0 = initConc.xw0;\n    const init: number[] = new Array(PROFILE_LENGTH);\n    init[0] = 0; // time\n    init[1] = 0; // top\n    for (let i=2;i<CONC_ARRAY_SIZE+2;i++) {\n        init[i] = xr0;\n    }\n    for (let i=2+CONC_ARRAY_SIZE;i<2*CONC_ARRAY_SIZE+2;i++) {\n        init[i] = xw0;\n    }\n\n    return new Float32Array(init);\n}","import type { WorkerMessage } from \"./worker-types\";\n\n// Base worker\nexport abstract class BaseWorker {\n    constructor() {\n        self.onmessage = (e) => this.handleMessage(e.data);\n    }\n\n    protected post<T>(msg: WorkerMessage<T>) {\n        (self as any).postMessage(msg);\n    }\n    protected error(reason: string, fatal?: boolean) {\n        const msg = {\n            type: \"error\",\n            payload: {\n                reason: reason,\n                fatal: fatal\n            }\n        };\n        (self as any).postMessage(msg);\n    }\n\n    protected abstract handleMessage(msg: WorkerMessage): void;\n}\n","import { ProfileSolver } from \"../calcs\";\nimport { BaseWorker } from \"./baseWorker\";\nimport type { DataMessage, InitMessage, WorkerMessage } from \"./worker-types\";\n\n// const printProducer = (str: string) => console.log(\"%c[Producer] \" + `%c${str}`, \"color: red\", \"color: white\");\n\ntry {\n/**\n * Producer class. On request, iterates its solver and sends the resulting data.\n */\nclass ProducerWorker extends BaseWorker {\n    private solver: ProfileSolver | undefined = undefined;\n\n    protected handleMessage(msg: WorkerMessage): void {\n        if (msg.type === \"init\") {\n            // printProducer(\"Recieved init message\");\n            msg = msg as InitMessage;\n            const payload = msg.payload;\n            if (!payload) {\n                this.error(\"no initializer payload\");\n            }\n            const { xr0, xw0 } = payload.initConditions ?? { xr0: 0.05, xw0: 0.05 };\n            this.solver = new ProfileSolver(xr0, xw0);\n            return;\n        }\n\n        if (msg.type === \"produce\") {\n            // printProducer(\"Recieved produce message\");\n            this.produce();\n            return;\n        }\n    }\n\n    private produce = () => {\n        if (!this.solver) {\n            this.error(\"uninitialized solver or buffer\");\n            return;\n        }\n\n        // Always generate data when available\n        const sol = this.solver.calculate_step();\n        const msg: DataMessage = { type: \"data\", payload: sol };\n        this.post(msg);\n        // printProducer(\"Result produced and sent\");\n    }\n}\n\nnew ProducerWorker();\n\n}\ncatch (e) {\n    self.postMessage({ type: \"fatal\", payload: e });\n}"],"names":["rk45_dormand_prince","f","y0","t0","tEnd","opts","dt","atol","rtol","dtMin","dtMax","safety","verbose","c2","c3","c4","c5","c6","c7","a21","a31","a32","a41","a42","a43","a51","a52","a53","a54","a61","a62","a63","a64","a65","a71","a72","a73","a74","a75","a76","b1","b3","b4","b5","b6","b7","bs1","bs3","bs4","bs5","bs6","bs7","t","y","h","err","tVals","yVals","last_k1","k1","k2","yi","i","k3","k4","k5","k6","k7","y5","y4","ssqe","a","b","scale","e","rho_f","g","mu","rho_r","d_r","rho_w","d_w","TUBE_LENGTH","CONC_ARRAY_SIZE","concentration","phi","dp","conc_r","conc_w","cr_max","cw_max","volume_fraction","conc","phi_r","phi_w","settling_coeff_g","d_p","rho_p","d_Ep","r_conc","w_conc","d_avg","ep","pow","Sr_g","Sw_g","particle_velocities","ph_r","ph_w","conc_f","rho_susp","d_ep","ep_r","ep_w","vrs","vws","vfc","vrc","vwc","grad","dx","len","dydx","left","right","rhs_adv_diff","dz","cr","cw","crvr","cwvw","red","white","adv_r","adv_w","inner_dif_r","inner_dif_w","dcri","dcwi","dif_r","dif_w","drdt","dwdt","movingAverageConvolve","windowSize","padWidth","padded","norm","smoothed","sum","j","interp","x","xp","fp","xi","nx","lo","hi","resize","z","nz","z_hi","min_idx","ph","lz","z_new","_","cr_new","cw_new","smooth_fsize","SOLVER_TIMESTEP","ProfileSolver","xr0","xw0","cr0","cw0","y_cur","rk45","cr_cur","cw_cur","resized","returnProf","BaseWorker","msg","reason","fatal","ProducerWorker","payload"],"mappings":"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"}