(function(){"use strict";function J(o,r,t,n,s={}){const{dt:h=(n-t)/1e3,atol:i=1e-6,rtol:l=.001,dtMin:w=1e-8,dtMax:f=Math.abs(n-t)/5,safety:g=.9}=s,m=1/4,y=3/8,_=12/13,e=1,A=1/2,E=1/4,ft=3/32,ut=9/32,wt=1932/2197,dt=-7200/2197,_t=7296/2197,pt=439/216,gt=-8,vt=3680/513,mt=-845/4104,yt=-8/27,At=2,Mt=-3544/2565,bt=1859/4104,$t=-11/40,kt=16/135,Et=6656/12825,Pt=28561/56430,St=-9/50,zt=2/55,Ct=25/216,It=1408/2565,Nt=2197/4104,Rt=-1/5;let v=t,p=r.slice(),u=h;const Z=[v],x=[p.slice()];for(;v<n;){if(u!==u)throw new Error("NaN encountered in h");v+u>n&&(u=n-v);const M=o(v,p.slice()),R=o(v+m*u,p.map((d,c)=>d+u*E*M[c])),P=o(v+y*u,p.map((d,c)=>d+u*(ft*M[c]+ut*R[c]))),T=o(v+_*u,p.map((d,c)=>d+u*(wt*M[c]+dt*R[c]+_t*P[c]))),j=o(v+e*u,p.map((d,c)=>d+u*(pt*M[c]+gt*R[c]+vt*P[c]+mt*T[c]))),Tt=o(v+A*u,p.map((d,c)=>d+u*(yt*M[c]+At*R[c]+Mt*P[c]+bt*T[c]+$t*j[c]))),Vt=p.map((d,c)=>d+u*(Ct*M[c]+It*P[c]+Nt*T[c]+Rt*j[c])),D=p.map((d,c)=>d+u*(kt*M[c]+Et*P[c]+Pt*T[c]+St*j[c]+zt*Tt[c])),B=Math.sqrt(p.map((d,c)=>Math.pow((D[c]-Vt[c])/(i+l*Math.abs(p[c])),2)).reduce((d,c)=>d+c,0)/p.length);B<=1&&(v+=u,p=D,Z.push(v),x.push(p.slice()));const Wt=g*Math.pow(1/Math.max(B,1e-10),.25);if(u=Math.min(f,u*Math.min(4,Math.max(.1,Wt))),u<w&&B>1)throw new Error("Step size underflow â€” integration failed")}return{t:Z,y:x}}const S=.868,K=981,Q=2.15,z=1.08,b=.0275,C=1,$=.055,X=305,a=500;function L(o,r){return 6*o/(Math.PI*r**3)}const O=o=>L(o,b),q=o=>L(o,$),V=O(1),W=q(1);function I(o,r){return o*Math.PI*r**3/6}const tt=o=>I(o,b),rt=o=>I(o,$);function F(o,r){return(r-S)*K*o**2/(18*Q)*1e3}function nt(o,r){if(o+r===0)return 0;const t=(o*b+r*$)/(o+r),n=1-(o+r)*(1-.4);if(n>=1)return 0;const s=(1-n)**(-1/3);return t*(s-1)}const ot=F(b,z),et=F($,C);function st(o,r){const t=I(o,b),n=I(r,$),s=1-t-n,h=t*z+n*C+s*S,i=nt(t,n),l=i>0?1-(1+i/b)**-3:1,w=i>0?1-(1+i/$)**-3:1,f=ot*(z-h)/(z-S)*l**4.6,g=et*(C-h)/(C-S)*w**4.6,m=-(t*f+n*g),y=f+m,_=g+m;return{red:y,white:_}}function N(o,r){const t=o.length;if(t<2)return[0];const n=new Array(t);n[0]=(o[1]-o[0])/r,n[t-1]=(o[t-1]-o[t-2])/r;for(let s=1;s<t-1;s++){const h=o[s-1],i=o[s+1];n[s]=(i-h)/2/r}return n}function ct(o,r){const t=o.slice(0,a),n=o.slice(a);t[0]=0,n[0]=0,t[a-1]=t[a-2],n[a-1]=n[a-2];const s=new Array(a),h=new Array(a);s[0]=0,h[0]=0;for(let e=1;e<a;e++){const{red:A,white:E}=st(t[e],n[e]);if(A!==A)throw new Error(`bad red at concentration ${t[e]} ${n[e]}`);if(s[e]=t[e]*A,h[e]=n[e]*E,s[e]!==s[e])throw new Error(`crvr err: ${s}`)}s[a-1]=0,h[a-1]=0;const i=N(s,r),l=N(h,r);for(let e=0;e<a;e++)if(i!==i)throw new Error(`adv_r error: ${i}`);const w=new Array(a),f=new Array(a);w[0]=5*(t[1]-t[0])/r*(1-t[0]/V)**10,f[0]=5*(n[1]-n[0])/r*(1-n[0]/W)**10;for(let e=1;e<a-1;e++){const A=(t[e+1]-t[e-1])/2/r,E=(n[e+1]-n[e-1])/2/r;if(w[e]=5*A*(1-t[e]/V)**10,f[e]=5*E*(1-n[e]/W)**10,w[e]!==w[e])throw new Error(`inner_dif_r err: ${w}`)}w[a-1]=5*(t[a-1]-t[a-2])/r*(1-t[a-1]/V)**10,f[a-1]=5*(n[a-1]-n[a-2])/r*(1-n[a-1]/W)**10;const g=N(w,r),m=N(f,r);g[0]=g[a-1]=0,m[0]=m[a-1]=0;const y=new Array(a),_=new Array(a);y[0]=_[0]=0;for(let e=1;e<a-1;e++)y[e]=g[e]-i[e],_[e]=m[e]-l[e];return y[a-1]=-i[a-1],_[a-1]=-l[a-1],y.concat(_)}function G(o,r){const t=Math.floor(r/2),n=o.length,s=[...Array(t).fill(o[0]),...o,...Array(t).fill(o[n-1])],h=1/r,i=new Array(n);for(let l=0;l<n;l++){let w=0;for(let f=0;f<r;f++)w+=s[l+f];i[l]=w*h}return i}function H(o,r,t){return Array.isArray(o)||(o=[o]),o.map(s=>{let h=r.length;if(s<r[0])return console.warn(`interp point ${s} out of min range for x array with min ${r[0]}`),t[0];let i=0,l=1;for(let f=0;f<h&&r[f]<=s;f++)i=f;return i===h-1?t[h-1]:(l=i+1,t[i]+(t[l]-t[i])*(s-r[i])/(r[l]-r[i]))})}function at(o,r,t){const n=o.slice(0,a),s=o.slice(a);if(n.length!==r.length||s.length!==r.length)throw new Error(`y and z must have same length
cr:${n.length}
cw:${s.length}
z:${r.length}`);const h=n.length,i=r[h-1];if(i<304.99)throw new Error(`z_hi = ${i} which is a significant deviation from l=305 mm`);let l,w=0;for(let _=0;_<n.length;_++){const e=n[_]+s[_];if(w+=e,w<t)l=_;else if(w>=2*t)break}if(l===void 0)return{y:o,z:r};const f=i-r[l],g=Array.from({length:h},(_,e)=>e/(h-1)*f+r[l]),m=H(g,r,n),y=H(g,r,s);return{y:m.concat(y),z:g}}const k=a,U=13,Y=20;class it{current;top=0;t=0;constructor(r,t){const n=new Array(k).fill(O(r)),s=new Array(k).fill(q(t));n[0]=s[0]=0,this.current=n.concat(s)}lz=()=>X-this.top;dz=()=>this.lz()/(k-1);create_z_arr=()=>{const r=this.dz();return Array.from({length:k},(t,n)=>n*r+this.top)};rhs=(r,t)=>ct(t,this.dz());calculate_step=()=>{let t=J(this.rhs,this.current,0,Y,{rtol:1e-4,atol:1e-6}).y.at(-1),n=t.slice(0,k),s=t.slice(k);n=G(n,U),s=G(s,U),t=n.concat(s);const h=at(t,this.create_z_arr(),.05);this.current=h.y,this.top=h.z[0],this.t+=Y,console.log("Solved to t=",this.t);const i=new Float32Array([this.t,this.top].concat(this.current));for(let l=2;l<502;l++)i[l]=tt(i[l]);for(let l=502;l<1002;l++)i[l]=rt(i[l]);return i}}class lt{constructor(){self.onmessage=r=>this.handleMessage(r.data)}post(r){self.postMessage(r)}error(r,t){const n={type:"error",payload:{reason:r,fatal:t}};self.postMessage(n)}}const ht=o=>console.log(`%c[Producer] %c${o}`,"color: red","color: white");try{class o extends lt{solver=void 0;handleMessage(t){if(t.type==="init"){t=t;const n=t.payload;n||this.error("no initializer payload");const{xr0:s,xw0:h}=n.initConditions??{xr0:.05,xw0:.05};this.solver=new it(s,h);return}if(t.type==="produce"){ht("Recieved produce message"),this.produce();return}}produce=()=>{if(!this.solver){this.error("uninitialized solver or buffer");return}const n={type:"data",payload:this.solver.calculate_step()};this.post(n)}}new o}catch(o){self.postMessage({type:"fatal",payload:o})}})();
//# sourceMappingURL=producer-bPLs2NL6.js.map
