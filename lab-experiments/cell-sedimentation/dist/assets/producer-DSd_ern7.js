(function(){"use strict";function tt(e,t,r,n,c={}){const{dt:h=(n-r)/1e3,atol:a=1e-6,rtol:l=.001,dtMin:w=1e-8,dtMax:u=Math.abs(n-r)/5,safety:v=.9,verbose:y=!1}=c,b=1/5,d=3/10,o=4/5,M=8/9,A=1,_t=1,dt=1/5,pt=3/40,mt=9/40,gt=44/45,vt=-56/15,yt=32/9,bt=19372/6561,Mt=-25360/2187,At=64448/6561,$t=-212/729,Et=9017/3168,kt=-355/33,Nt=46732/5247,Pt=49/176,Ft=-5103/18656,Rt=35/384,St=0,qt=500/1113,Ct=125/192,It=-2187/6784,Tt=11/84,zt=35/384,Ut=500/1113,Vt=125/192,Wt=-2187/6784,jt=11/84,Bt=0,Kt=5179/57600,Lt=7571/16695,Ot=393/640,xt=-92097/339200,Gt=187/2100,Ht=1/40;let p=r,m=t.slice(),f=h,N=1;const Q=[p],X=[m.slice()];let z=null;for(;p<n;){if(f!==f)throw new Error("NaN encountered in h");p+f>n&&(f=n-p);try{let g;z?g=z:(g=e(p,m.slice()),z=g);const F=e(p+b*f,m.map((_,s)=>_+f*dt*g[s])),P=e(p+d*f,m.map((_,s)=>_+f*(pt*g[s]+mt*F[s]))),R=e(p+o*f,m.map((_,s)=>_+f*(gt*g[s]+vt*F[s]+yt*P[s]))),U=e(p+M*f,m.map((_,s)=>_+f*(bt*g[s]+Mt*F[s]+At*P[s]+$t*R[s]))),j=e(p+A*f,m.map((_,s)=>_+f*(Et*g[s]+kt*F[s]+Nt*P[s]+Pt*R[s]+Ft*U[s]))),B=e(p+_t*f,m.map((_,s)=>_+f*(Rt*g[s]+St*F[s]+qt*P[s]+Ct*R[s]+It*U[s]+Tt*j[s]))),K=m.map((_,s)=>_+f*(zt*g[s]+Ut*P[s]+Vt*R[s]+Wt*U[s]+jt*j[s]+Bt*B[s])),Yt=m.map((_,s)=>_+f*(Kt*g[s]+Lt*P[s]+Ot*R[s]+xt*U[s]+Gt*j[s]+Ht*B[s])),Zt=m.map((_,s)=>Math.pow((K[s]-Yt[s])/(a+l*Math.max(Math.abs(m[s]),Math.abs(K[s]))),2)).reduce((_,s)=>_+s,0);N=Math.sqrt(Zt/m.length),N<=1&&(p+=f,y&&console.log(`[RK45] Accepted step to t=${p} with h=${f} (err=${N})`),m=K,Q.push(p),X.push(m.slice()),z=B.slice());const L=v*Math.pow(1/Math.max(N,1e-10),.2);if(L!==L)throw new Error("NaN encountered in h adaptation");f=Math.min(u,f*Math.min(5,Math.max(.2,L)))}catch(g){y&&console.error("Error computing RK45 stages at t =",p,"with h =",f,":",g),N=2,f=f*.5}if(f<w&&N>1)if(c.onUnderflow)c.onUnderflow();else throw new Error("Step size underflow â€” integration failed")}return{t:Q,y:X}}const S=.868,rt=981,nt=2.15,q=1.08,$=.0275,C=1,E=.055,et=305,i=500;function O(e,t){return 6*e/(Math.PI*t**3)}const x=e=>O(e,$),G=e=>O(e,E),V=x(1),W=G(1);function I(e,t){return e*Math.PI*t**3/6}const ot=e=>I(e,$),st=e=>I(e,E);function H(e,t){return(t-S)*rt*e**2/(18*nt)*1e3}function ct(e,t){if(e+t===0)return 0;const r=(e*$+t*E)/(e+t),n=1-(e+t)*(1-.4);if(n>=1)return 0;const c=(1-n)**(-1/3);return r*(c-1)}const it=H($,q),at=H(E,C);function lt(e,t){const r=I(e,$),n=I(t,E);if(r+n>=1)return{red:0,white:0};const c=1-r-n,h=r*q+n*C+c*S,a=ct(r,n),l=a>0?1-(1+a/$)**-3:1,w=a>0?1-(1+a/E)**-3:1,u=it*(q-h)/(q-S)*l**4.6,v=at*(C-h)/(C-S)*w**4.6,y=-(r*u+n*v),b=u+y,d=v+y;return{red:b,white:d}}function T(e,t){const r=e.length;if(r<2)return[0];const n=new Array(r).fill(0);n[0]=(e[1]-e[0])/t,n[r-1]=(e[r-1]-e[r-2])/t;for(let c=1;c<r-1;c++){const h=e[c-1],a=e[c+1];n[c]=(a-h)/2/t}return n}function ht(e,t){const r=e.slice(0,i),n=e.slice(i);if(!Number.isFinite(t)||t<=0)throw new Error(`rhs_adv_diff: bad dz=${t}`);for(let o=0;o<e.length;o++)if(!Number.isFinite(e[o]))throw new Error(`rhs_adv_diff: non-finite y[${o}] = ${e[o]}`);r[0]=0,n[0]=0,r[i-1]=r[i-2],n[i-1]=n[i-2];const c=new Array(i).fill(0),h=new Array(i).fill(0);c[0]=0,h[0]=0;for(let o=1;o<i;o++){const{red:M,white:A}=lt(r[o],n[o]);if(!Number.isFinite(M)||!Number.isFinite(A))throw new Error(`particle_velocities returned non-finite at i=${o} cr=${r[o]} cw=${n[o]} red=${M} white=${A}`);if(c[o]=r[o]*M,h[o]=n[o]*A,c[o]!==c[o])throw new Error(`crvr err: ${c}`)}c[i-1]=0,h[i-1]=0;const a=T(c,t),l=T(h,t),w=new Array(i).fill(0),u=new Array(i).fill(0);w[0]=5*(r[1]-r[0])/t*(1-r[0]/V)**10,u[0]=5*(n[1]-n[0])/t*(1-n[0]/W)**10;for(let o=1;o<i-1;o++){const M=(r[o+1]-r[o-1])/2/t,A=(n[o+1]-n[o-1])/2/t;if(w[o]=5*M*(1-r[o]/V)**10,u[o]=5*A*(1-n[o]/W)**10,w[o]!==w[o])throw new Error(`inner_dif_r err: ${w}`)}w[i-1]=5*(r[i-1]-r[i-2])/t*(1-r[i-1]/V)**10,u[i-1]=5*(n[i-1]-n[i-2])/t*(1-n[i-1]/W)**10;const v=T(w,t),y=T(u,t);v[0]=v[i-1]=0,y[0]=y[i-1]=0;const b=new Array(i).fill(0),d=new Array(i).fill(0);b[0]=d[0]=0;for(let o=1;o<i-1;o++)b[o]=v[o]-a[o],d[o]=y[o]-l[o];return b[i-1]=b[i-2],d[i-1]=d[i-2],b.concat(d)}function Y(e,t){const r=Math.floor(t/2),n=e.length,c=[...Array(r).fill(e[0]),...e,...Array(r).fill(e[n-1])],h=1/t,a=new Array(n);for(let l=0;l<n;l++){let w=0;for(let u=0;u<t;u++)w+=c[l+u];a[l]=w*h}return a}function Z(e,t,r){return Array.isArray(e)||(e=[e]),e.map(c=>{let h=t.length;if(c<t[0])return console.warn(`interp point ${c} out of min range for x array with min ${t[0]}`),r[0];let a=0,l=1;for(let u=0;u<h&&t[u]<=c;u++)a=u;return a===h-1?r[h-1]:(l=a+1,r[a]+(r[l]-r[a])*(c-t[a])/(t[l]-t[a]))})}function ft(e,t,r){const n=e.slice(0,i),c=e.slice(i);if(n.length!==t.length||c.length!==t.length)throw new Error(`y and z must have same length
cr:${n.length}
cw:${c.length}
z:${t.length}`);const h=n.length,a=t[h-1];if(a<304.99)throw new Error(`z_hi = ${a} which is a significant deviation from l=305 mm`);let l,w=0;for(let d=0;d<n.length;d++){const o=n[d]+c[d];if(w+=o,w<r)l=d;else if(w>=2*r)break}if(l===void 0)return{y:e,z:t};const u=a-t[l],v=Array.from({length:h},(d,o)=>o/(h-1)*u+t[l]),y=Z(v,t,n),b=Z(v,t,c);return{y:y.concat(b),z:v}}const k=i,D=11,J=20;class ut{current;top=0;t=0;constructor(t,r){const n=new Array(k).fill(x(t)),c=new Array(k).fill(G(r));n[0]=c[0]=0,this.current=n.concat(c)}lz=()=>et-this.top;dz=()=>this.lz()/(k-1);create_z_arr=()=>{const t=this.dz();return Array.from({length:k},(r,n)=>n*t+this.top)};rhs=(t,r)=>ht(r,this.dz());calculate_step=()=>{let r=tt(this.rhs,this.current,0,J,{rtol:1e-4,atol:1e-6}).y.at(-1),n=r.slice(0,k),c=r.slice(k);n=Y(n,D),c=Y(c,D),r=n.concat(c);const h=ft(r,this.create_z_arr(),5);this.current=h.y,this.top=h.z[0],this.t+=J;const a=new Float32Array([this.t,this.top].concat(this.current));for(let l=2;l<502;l++)a[l]=ot(a[l]);for(let l=502;l<1002;l++)a[l]=st(a[l]);return a}}class wt{constructor(){self.onmessage=t=>this.handleMessage(t.data)}post(t){self.postMessage(t)}error(t,r){const n={type:"error",payload:{reason:t,fatal:r}};self.postMessage(n)}}try{class e extends wt{solver=void 0;handleMessage(r){if(r.type==="init"){r=r;const n=r.payload;n||this.error("no initializer payload");const{xr0:c,xw0:h}=n.initConditions??{xr0:.05,xw0:.05};this.solver=new ut(c,h);return}if(r.type==="produce"){this.produce();return}}produce=()=>{if(!this.solver){this.error("uninitialized solver or buffer");return}const n={type:"data",payload:this.solver.calculate_step()};this.post(n)}}new e}catch(e){self.postMessage({type:"fatal",payload:e})}})();
//# sourceMappingURL=producer-DSd_ern7.js.map
