import { describe, expect, it } from 'vitest';
import { plotArrs, plotFn } from '../setupTests';
import { conc_r, conc_w, movingAverageConvolve, particle_velocities, phi_r, phi_w, ProfileSolver, resize, rhs_adv_diff } from './calcs';
import { rk45_dormand_prince } from './rk45';
// import * as fs from "fs";
import type { InitConc } from '../types/globals';


describe('calcs.ts function visualization', () => {
    // it("tests the rhs function at initial conditions", async () => {
    //     const pydata = new Promise<number[]>((resolve, reject) => {

    //         fs.readFile("./test/pyRhs.csv", "utf8", (err, data: string) => {
    //             if (err) {
    //                 console.warn(err);
    //                 reject();
    //             }
    //             resolve(data.split('\n').map(str => Number(str)));
    //         });

    //     });

    //     const nz = 500;
    //     const lz = 305;
    //     const dz = lz / (nz-1);
    //     const xr0 = .05;
    //     const xw0 = .05;
    //     const cr0 = Array.from({ length: nz }, () => conc_r(xr0));
    //     const cw0 = Array.from({ length: nz }, () => conc_w(xw0));
    //     const y0 = cr0.concat(cw0);
    //     const rhs = rhs_adv_diff(y0, dz);
        
    //     const py = await pydata;
    //     const res = rhs.map((ts, i) => ts - py[i]);
    //     console.log(res)
    //     const ssqe = res.reduce((sum, err) => sum + err ** 2);
    //     console.log(ssqe)


    //     let zs = Array.from({ length: nz*2 }, (_,i) => i);
    //     await plotArrs(zs, [res], {}, { title: { text: "Residuals of RoC for initial function call" }});
    //     await plotArrs(zs, [rhs, py], {}, { title: { text: "RoC for initial function call" }});
    // }, 10000); 

    // it("tests the rhs function with a sinusoidal concentration profile", async () => {
    //     const pydata = new Promise<number[]>((resolve, reject) => {

    //         fs.readFile("./test/pySinRhs.csv", "utf8", (err, data: string) => {
    //             if (err) {
    //                 console.warn(err);
    //                 reject();
    //             }
    //             resolve(data.split('\n').map(str => Number(str)));
    //         });

    //     });

    //     const nz = 500;
    //     const lz = 305;
    //     const dz = lz / (nz-1);
    //     const xr0 = .05;
    //     const xw0 = .05;
    //     const cr0 = Array.from({ length: nz }, (_,i) => (.5 + .5 * Math.sin(i * Math.PI / 90)) * conc_r(xr0));
    //     const cw0 = Array.from({ length: nz }, (_,i) => (.5 + .5 * Math.cos(i * Math.PI / 90)) * conc_w(xw0));
    //     const y0 = cr0.concat(cw0);
    //     const rhs = rhs_adv_diff(y0, dz);
        
    //     const py = await pydata;
    //     const res = rhs.map((ts, i) => ts - py[i]);
    //     console.log(res) 
    //     const ssqe = res.reduce((sum, err) => sum + err ** 2);
    //     console.log(ssqe) 


    //     let zs = Array.from({ length: nz*2 }, (_,i) => i);
    //     await plotArrs(zs, [rhs, py], {}, { title: { text: "RoC for sinusoidal concs" } });
    //     await plotArrs(zs, [res], {}, { title: { text: "Residuals for sinusoidal RoCs" }});
    // }, 10000); 

    it ("tests the particle velocity calculations", async () => {
        const xr0 = Array.from({ length: 10 }, (_,i) => i * 0.1);
        const xw0 = Array.from({ length: 100 }, (_,i) => i * 0.01);

        const vr = [];
        const vw = []; 
        for (let xr of xr0) {
            const vr_row = [];
            const vw_row = [];
            for (let xw of xw0) {
                const { red, white } = particle_velocities(conc_r(xr), conc_w(xw));
                vr_row.push(red);
                vw_row.push(white);
            }
            vr.push(vr_row);
            vw.push(vw_row);
        }

        await plotArrs(xw0, vr, {}, { title: { text: `Red Cell Velocity vs White Cell Concentration (xr0 varied)` } });
    });

    // it ("tests the solver capabilities to handle a single ic", async () => {
    //     let ic: InitConc = { xr0: 0.03, xw0: 0.05 };
    //     let sol = new ProfileSolver(ic.xr0, ic.xw0);
    //     const crs: number[][] = [], cws: number[][] = [];
    //     const zs = [];

    //     for (let i=0; i<10; i++) {
    //         console.log(`[Test] calculating step ${i+1} (time t=${(i+1)*20}s)`);
    //         const res = sol.calculate_step();
    //         crs.push([...res.slice(2,502)]);
    //         cws.push([...res.slice(502)]);

    //         const top = res[1];
    //         const l = 305 - top;
    //         const dz = (l - 1) / 500;
    //         zs.push(Array.from({ length: 500 }, (_,i) => top + i * dz));

    //         plotArrs(zs, crs, {}, { title: { text: "cr" }});
    //         await plotArrs(zs, cws, {}, { title: { text: "cw" }});
    //     }

    //     plotArrs(zs, crs, {}, { title: { text: "cr" }});
    //     await plotArrs(zs, cws, {}, { title: { text: "cw" }});
    // }, 100000);

    // it("tests the rhs function at extreme conditions", async () => {
    //     const pydata = new Promise<number[]>((resolve, reject) => {

    //         fs.readFile("./test/pySinRhs.csv", "utf8", (err, data: string) => {
    //             if (err) {
    //                 console.warn(err);
    //                 reject();
    //             }
    //             resolve(data.split('\n').map(str => Number(str)));
    //         });

    //     });

    //     const nz = 500;
    //     const dz = 0.5744756045156445;
    //     const y = [0.008573712890852504,0.003344125276334445,0.0076296732502717365,0.011990056130462754,0.016242446748622682,0.020746844193867145,0.025730330175024085,0.0315507852640359,0.038442463309451225,0.04667777847206439,0.05653469684497951,0.06832714697749867,0.08241243683658124,0.09920777764143328,0.11920377057297403,0.14296458502721268,0.17119533198069806,0.2046425192394194,0.2443192866715882,0.29122108303365185,0.34657792539309307,0.4117431350742121,0.48830403402843947,0.5780739781905421,0.68314028754434,0.8058843823417023,0.949037767222097,1.1156778734026185,1.3093904330871304,1.534066689223978,1.7945119227159751,2.095482880942471,2.4436317669523757,2.84489863208442,3.3079772893744512,3.8412132420582292,4.4542242143111626,5.157429962027585,5.962516236448176,6.882564258797103,7.932189577359402,9.127685310642228,10.487112248186056,12.030575264855065,13.780052194826602,15.760492110398603,17.997902771710613,20.52431227451301,23.36871386222287,26.575090889128138,30.174680006783365,34.2246544094299,38.76541159147366,43.85183666553305,49.53587951437419,55.87729400982921,62.939502584956166,70.79169707596697,79.50801469976285,89.16807632248118,99.85646058609984,111.66400208655094,124.68531397134062,139.02391372609992,154.78365238717262,172.08292160964155,191.04036215848407,211.78232273907972,234.45422301696323,259.1709043740745,286.0611203180927,315.2417253562784,346.8345723934587,380.9572966310821,417.7242974712463,457.2423526976045,499.6089783038488,544.9076877179297,593.2096020353982,644.5596759908456,698.9978375495538,756.5072135081696,817.1038158364049,880.6851779513913,947.2306065840777,1016.5744702650069,1088.5527448153355,1162.934843661737,1239.466527764602,1317.8573575851601,1397.7879499027745,1478.9100269876453,1560.8507792818039,1643.2175187847565,1725.6041145595163,1807.5963118433092,1888.7826336015132,1968.7509702939542,2047.1198115031054,2123.487402552727,2197.5444793959336,2268.902968704466,2337.3416560720407,2402.6289545230065,2464.6139851114553,2523.174506020331,2578.2365646366425,2629.7653388578924,2677.7661264450817,2722.280218199727,2763.3816706595485,2801.171913975706,2835.77767337513,2867.339799905318,2896.022711528236,2921.980162473,2945.400547748098,2966.43309580671,2985.2568956668542,3002.065872133832,3017.039646087203,3030.351901956575,3042.1606418742485,3052.613271197988,3061.8458202812135,3069.9842248761656,3077.1444618681417,3083.4330207858998,3088.946987895799,3093.775127443307,3097.9965106557,3101.6852467463004,3104.901573709485,3107.7098021784204,3110.1510485652193,3112.2795254505363,3114.1352082036274,3115.7571397473657,3117.1771593095464,3118.4233421344097,3119.5196999965024,3120.487078836295,3121.3434575446868,3122.10429728519,3122.7827867643327,3123.390064470932,3123.9353815943,3124.426262995134,3124.8686207227875,3125.266659207249,3125.623470910542,3125.939758382334,3126.2163238594494,3126.4517481707544,3126.643513303974,3126.7873344687173,3126.877359656488,3126.905971084968,3126.8636941685886,3126.738966363813,3126.5180471817885,3126.1844187323504,3125.719391281363,3125.099693595002,3124.3013580499523,3123.291186637512,3122.0386277449466,3120.499324060949,3118.6276782430746,3116.3756017150095,3113.6903413244,3110.515188765545,3106.7890710425895,3102.4479010244645,3097.4259958525704,3091.658210596598,3085.0825067523597,3077.6433660557623,3069.2948536072186,3060.006246862866,3049.761819453957,3038.574112325998,3026.4669970515693,3013.513520909357,2999.782079242868,2985.4032073484277,2970.517726467313,2955.2921116811594,2939.900492089313,2924.522857564679,2909.33740118656,2894.5150684210566,2880.213717498857,2866.5729182542523,2853.710072456894,2841.7164704035,2830.657537303217,2820.569059925724,2811.4640476656114,2803.329843386845,2796.131989613075,2789.8328481861568,2784.36258351596,2779.6476088170593,2775.608051605461,2772.1672202881223,2769.251865728763,2766.7940303778564,2764.731409305894,2763.007760041476,2761.5729215889633,2760.382744506441,2759.398616493982,2758.587469105218,2757.9203684017507,2757.373848200612,2756.9263523311265,2756.5619395279978,2756.265621901837,2756.025118928979,2755.8300172536083,2755.6718368368047,2755.5437238801055,2755.440069206661,2755.3563328975047,2755.288799089957,2755.234391544886,2755.19070054746,2755.155553094102,2755.127522020829,2755.10491481349,2755.0871224623866,2755.0726129325417,2755.061475823848,2755.052183116918,2755.045340505031,2755.039394998163,2755.035226009052,2755.031441807581,2755.0288524408675,2755.026574497575,2755.0247613815727,2755.0237372370634,2755.0219896385424,2755.022312697858,2755.0198810821535,2755.021930735834,2755.0180621567956,2755.022195517392,2755.0166216421403,2755.0224179831202,2755.015974299921,2755.0222429630194,2755.016001092203,2755.0214960103426,2755.0169371482752,2755.019757657526,2755.019268049176,2755.0163662178743,2755.0237242271755,2755.0104519096635,2755.031180322967,2755.0012483655332,2755.041854479018,2754.9896511249426,2755.0526473464356,2754.981197309798,2755.056085164866,2754.9814672216316,2755.0530826045288,2754.9883709304845,2755.042733400398,2755.0032999376353,2755.0227112311354,2755.0294315713063,2754.9895849266145,2755.070572938504,2754.939659277531,2755.1296256925248,2754.8724501909014,2755.2015869637958,2754.8028741921707,2755.256490643527,2754.773847440527,2755.249820184708,2754.8009960913773,2755.206544177874,2754.8645081064756,2755.12804425841,2754.9625771983124,2755.0108183985476,2755.1008523253563,2754.8501492909286,2755.2839431838347,2754.6444117299766,2755.507763054971,2754.410550802976,2755.732164592704,2754.2280701104005,2755.83506716109,2754.242797603106,2755.720584247708,2754.4034783684647,2755.5110564617726,2754.642996702256,2755.241187766681,2754.9358540377525,2754.9217713092776,2755.27234879411,2754.5631438898695,2755.639986421448,2754.184189236606,2756.008767361279,2753.839213902139,2756.2863236045146,2753.684703792148,2756.2737934222578,2753.915527117708,2755.948875481636,2754.260682376504,2755.553971329497,2754.634839417607,2755.174846502544,2754.9920614419325,2754.836331189235,2755.303108115815,2754.5589707247864,2755.5441422947238,2754.3661557210435,2755.687060877979,2754.293398592678,2755.68402736418,2754.397084605656,2755.491841429891,2754.6603381985424,2755.2448847012856,2754.8841902682916,2755.0661634136136,2755.0133177673124,2754.995690875872,2755.030950694683,2755.0404997971955,2754.932522096401,2755.1989822912137,2754.723158757405,2755.456921232806,2754.432967479847,2755.7556420540486,2754.1693868584766,2755.9353451796683,2754.1260530532913,2755.8561861084813,2754.270195567383,2755.6322412532577,2754.539324861761,2755.3045464282513,2754.9046426338286,2754.886055938498,2755.355916654091,2754.3842577198993,2755.8856472640578,2753.8119737430407,2756.4676528192153,2753.230532358725,2756.9810750073552,2752.8681735100863,2757.11338484049,2753.0662461237243,2756.73432017694,2753.5133678870106,2756.1626790107252,2754.112634410024,2755.483854732551,2754.842754845207,2754.682367584823,2755.717698735358,2753.731464946358,2756.758120963344,2752.623162226756,2757.935396950339,2751.465691864984,2758.993705157516,2750.7268186393517,2759.2790836385,2751.083945384389,2758.6299400908338,2752.0344120744276,2757.539586377649,2753.3561066082175,2756.147220105884,2755.0177453779406,2754.4399364655405,2757.0391621433346,2752.394730926192,2759.423439555554,2750.0480999429383,2762.02805755212,2747.7188654148426,2764.1476325933354,2746.5162426141487,2764.264891862568,2747.817619303946,2762.6952309411954,2750.2127396604237,2760.3425689207384,2753.1250596317473,2757.5372840570635,2756.426703513424,2754.3654435319554,2760.0574588326303,2750.890428511182,2763.9115894325823,2747.2850172568747,2767.6251748311456,2744.2113295442773,2769.9412943362713,2743.4319575798577,2768.7332996971686,2746.1611326484513,2765.615548500277,2749.940743624668,2761.842905729357,2753.909544607742,2757.87701532274,2757.8873735918905,2753.8820907922077,2761.783552782045,2749.974629524678,2765.4637787806228,2746.3952169121953,2768.510832207593,2743.956079034644,2769.63850202456,2744.3782877720846,2767.235322957635,2747.3986939437723,2763.6002169657772,2750.9686366923274,2759.8753021174716,2754.4016238170625,2756.3600111215787,2757.575661368233,2753.124942723137,2760.4620156881097,2750.2139931350134,2762.996903906864,2747.7919878814805,2764.8735646680866,2746.525848636367,2765.1392534997517,2747.657524884641,2762.946475717019,2750.084995409706,2760.333675481152,2752.780295523478,2758.0741487727105,2755.5711022179335,2756.4831828019496,2758.8218249639667,2756.1318975007166,2763.509556073978,2758.48155330177,2771.895003946931,2767.2665796088554,2789.271869135326,2791.9099097428425,2828.758995862196,2855.109908410423,2924.497675175634,3007.89436608357,3155.262556188219,3361.276683109481,3671.7749375881976,4097.12224758145,4639.076783770741,5233.100244562894,5823.039241821252,6434.996461214886,7022.5978404584785,7688.372328839889,8278.44341535966,9015.437357777877,9579.78144917322,10372.98974616095,10875.972361472152,11635.925502790338,12002.43774601218,12623.170598322668,12883.473384575085,13445.026844256383,14305.31246281251,14958.842162451227,21444.866913419497,36900.376836752235,52916.38855460833,68268.42458302829,85579.06007775826,-3166.9097149153786,112666.62740993206,334039.0212476575,4.62994717292755e-8,3.7188769619654254e-9,-1.8324571038504267e-8,-2.3278895734563266e-8,-4.617749868279144e-9,8.492468596824797e-9,-7.004422388400307e-11,-6.8574147944357575e-9,4.40262168545595e-9,1.6696781649743092e-8,1.1279805954292223e-8,-7.275879789827875e-10,3.864116047335939e-9,1.6959940815533362e-8,1.664930849722209e-8,1.5078775469986273e-9,6.748954063255833e-10,1.5149216914629354e-8,1.5910780701783782e-8,2.848820099698415e-9,-1.7025126598119453e-9,6.0735368693982e-9,8.698997817490813e-9,3.197451770589013e-10,-6.211600064537013e-9,-2.934767553247947e-9,1.2507632682677269e-9,-2.95458641465824e-9,-1.0212863856200922e-8,-9.40123855334757e-9,-4.451941937846248e-9,-4.701188452927542e-9,-1.1619178303691239e-8,-1.1833300668794362e-8,-6.139938806321107e-9,-4.8796050408886e-9,-8.64115839113217e-9,-9.647772504559046e-9,-6.269187039619695e-9,-4.0332136538763105e-9,-5.2849244463999385e-9,-6.424464006232154e-9,-4.712334227860219e-9,-2.34282320709142e-9,-2.256153544804669e-9,-3.4825271777714334e-9,-2.9659991018337523e-9,-1.1684989492016916e-9,-4.2311107284945886e-10,-1.6019064620869831e-9,-1.728316214817098e-9,-5.408477045794281e-10,1.0752631776852048e-10,-3.74462884642783e-10,-7.512967636840426e-10,-3.869214659039052e-10,5.410431620055062e-11,-1.7319276700003946e-11,-3.0343118084234887e-10,-2.889629974651612e-10,-2.4576643795632992e-11,8.694413401734198e-11,-4.5050307096054744e-11,-1.1210519415716927e-10,3.4340995278595827e-11,2.4287771737702534e-10,3.5263524168549633e-10,5.546525126141888e-10,1.0856681535334944e-9,2.0859172063715354e-9,3.811275001302948e-9,6.8645421647780906e-9,1.2374241308822809e-8,2.2106387085593368e-8,3.930483716535987e-8,6.880672990349742e-8,1.2021363845176526e-7,2.0582612299891376e-7,3.534843776908337e-7,5.919390355289588e-7,9.940741286799694e-7,0.0000016331918908552342,0.000002678760776618578,0.000004328085622586353,0.0000069332214936350036,0.000011003453931238712,0.000017285718800633074,0.000026846148080132778,0.00004119445816966451,0.00006243982841690142,0.00009347993101452938,0.0001382609170696463,0.00020202538209224455,0.0002917885778656851,0.0004164645288681237,0.0005881414612810597,0.0008208534951816283,0.0011350418463998264,0.001551605102954131,0.0021042703352560695,0.0028243228792535664,0.003761997924151757,0.004970095618481078,0.0065144823597913255,0.008470683175593552,0.01092863421713136,0.013993619501093279,0.01778892914713915,0.0224574303803622,0.02816534398680246,0.03510158202292597,0.04348847649903447,0.05356866193615543,0.06563864730340584,0.08000448505745261,0.09705940315903608,0.1172068018964599,0.14093199439783194,0.16880811089501513,0.2014274090842317,0.23945187629295317,0.2835984992429046,0.33466901048402575,0.39354968112158706,0.4612234987281265,0.5387677504126692,0.627381277494558,0.7283400928274678,0.8431315341262946,0.973182938092279,1.1204309692913794,1.2863346612148219,1.473539946532209,1.6835739165512447,1.919599827296068,2.184022710802916,2.4798128658846568,2.8098356383632623,3.1772840748061206,3.5855823843773256,4.038460084630271,4.5399486287636135,5.094410035677785,5.706557602121967,6.381478454995915,7.124723328637497,7.942143889481248,8.840520269151838,9.826406410235709,10.908769997117004,12.09472888809824,13.395964715088706,14.822048705043313,16.384507313631623,18.094949799796318,19.966578199091703,22.013925704372173,24.25323424298506,26.702470799889024,29.381773278513826,32.31307808320627,35.5217766931842,39.03388157007184,42.882376733249316,47.097089009033745,51.7216325935505,56.79218391789452,62.36021218973406,68.47899322256318,75.20311355338893,82.58902773292222,90.69489098588868,99.58106367384651,109.30837052590834,119.9361005655822,131.5191196700473,144.10451456189594,157.72735637468355,172.40690714381208,188.1406350240687,204.90338689415339,222.63657184117565,241.25910404787575,260.6439763356893,280.6501060384353,301.0905200785309,321.7599807522162,342.43618427628434,362.8937508445879,382.91119683777777,402.27931175679225,420.8082333197542,438.33382318221504,454.7229347294942,469.87666430278466,483.7329896948426,496.26447866007686,507.4800456079356,517.4141442805862,526.1293653838006,533.7061377035035,540.2239421979654,545.7944606758919,550.525588379393,554.5245422692153,557.8890142619542,560.7078253243373,563.0602506197584,565.0164548049152,566.6378821379009,567.9778641784055,569.0822529463312,569.9902902680966,570.7350311458355,571.3448650834845,571.8425792926223,572.2488380283429,572.5786260841664,572.8459928228166,573.0625116319026,573.2378166401671,573.3797222904067,573.4944877056965,573.5872205134522,573.6620397732111,573.7223118569615,573.7708143014694,573.8097235099348,573.8409920579337,573.8659061229455,573.885982296448,573.9017653158359,573.9146326777251,573.9244920250516,573.9327213022032,573.9387602925026,573.9440193009187,573.9476883682637,573.95103609675,573.9533071519064,573.9553237570678,573.9569106620348,573.9578156035933,573.9593546148611,573.9590532965937,573.9612275012477,573.9593518834886,573.9628746163642,573.9590507258481,573.9642066265308,573.9588166915737,573.9647741378029,573.9589703841415,573.9647510486462,573.9596338094628,573.9639082830437,573.9612030910334,573.9617890524901,573.9642976706649,573.9577061109159,573.9697447373633,573.9508002521686,573.9783460000366,573.9407104120818,573.9894619482207,573.9301962951287,573.9977577060206,573.9271111331468,573.997292841196,573.9299700012837,573.990965170248,573.9395799113189,573.9772625975429,573.9582524780874,573.9530862674593,573.9893402301077,573.914744537923,574.0365873834929,573.8590917546575,574.1012462048889,573.7897542419262,574.170329481968,573.7351197425003,574.2002192164393,573.7440831980977,574.1737460895553,573.7866277998694,574.1149717735564,573.8625834096174,574.024161375081,573.9761118884755,573.8951781747636,574.1323795514292,573.7230552798371,574.3341370864019,573.5099622441094,574.5681945776748,573.2908536749985,574.7601559759954,573.1873551980784,574.7512336165327,573.3124944197233,574.5976059015541,573.523577463841,574.3724069573019,573.7919309710957,574.0960183209841,574.1094355423676,573.7754536635377,574.4668189382983,573.4211735220008,574.8472056465586,573.0588713550227,575.2020265668165,572.7737584704234,575.3771108555263,572.7750627256835,575.1382381099223,573.1128581134705,574.7910515023792,573.5042139258031,574.4154982891732,573.875958471906,574.0534245397647,574.2085073399799,573.7324291927979,574.4827161153916,573.4759230936032,574.6765994850228,573.3115776498802,574.756052979598,573.2898060178471,574.6575886421314,573.4731576681633,574.375602576987,573.7282767258206,574.1375750464698,573.9149575651925,573.9952175043273,573.9981222360954,573.9631306338842,573.9733810314866,574.0445169534693,573.8432488325891,574.2333966461679,573.6210538856014,574.5019819570167,573.3591091797938,574.7515759711961,573.2071002008151,574.7890578135471,573.3028278201058,574.6593608933471,573.5179474346584,574.42580157488,573.8146113565014,574.1177592140664,574.1735673697826,573.7534798098845,574.5758495513435,573.3522249347083,574.9968650610533,572.9481452553289,575.3775009821676,572.6436720810008,575.5405844897061,572.6737193322277,575.245827751718,573.0476914732997,574.8519054021626,573.4745049810856,574.4306349647261,573.8846335434876,574.0154049316974,574.2674748571054,573.6254683125488,574.612958653042,573.2767124503681,574.9030899690049,573.0005200404647,575.0842335648834,572.891559472125,575.0208008209154,573.098278859978,574.6666922415877,573.4269249634301,574.3232825915238,573.7277941352141,574.0357076469016,573.9664849640035,573.815440281229,574.1380462712783,573.6700580161331,574.2387853090808,573.6067080522018,574.2600787377114,573.6411788431814,574.1765065474626,573.8046543743812,573.9696121536934,574.0578605919656,573.8143215045052,574.1903218055414,573.7663272729151,574.2347163592577,573.8076702699699,574.2077123335976,573.9242366122055,574.1156962715177,574.1066054800883,573.9643911275869,574.34624901011,573.7586747961187,574.63340946068,573.5126270163014,574.916504854223,573.3304299510363,574.9894554471582,573.4486196438603,574.8558211086253,573.6674563542641,574.6422704734962,573.9174010063442,574.3979200875407,574.175957265845,574.1401305487594,574.4305173453215,573.8794706998652,574.6733063768206,573.6239229304059,574.8965118413156,573.3994902142001,575.0411564602816,573.3310724690666,574.9142377493084,573.5031922453434,574.6696843149796,573.7178635512741,574.4204037625002,573.9109924300607,574.2020107660626,574.067710883628,574.0237310926808,574.1860391733956,573.8837210258988,574.275063676092,573.7683006770826,574.3567832875026,573.6643239814482,574.4282051333587,573.6329100630637,574.3578727553955,573.7175450947208,574.2608218619994,573.8369047442093,574.1919468746986,573.9787715453714,574.2029685469058,574.1716624127978,574.3943138803419,574.5165859527217,574.973682975836,575.3215962340636,576.4084618366508,577.445088838718,579.9344831529398,583.2175394855786,589.3676958880214,599.3522651793934,616.953229066831,647.3486589058602,702.2361621313288,799.2222415125751,971.1646942363942,1281.9564673037103,1752.634650336184,2300.2451305036516,2832.399578136492,3328.628973948586,3797.1528803524297,4253.385499178328,4697.123304709551,5139.594738471676,5569.974616531718,5992.885535457323,6387.751930838284,6730.61915344208,6955.176260982969,7055.485517699398,7063.090375994712,7042.662161310632,6961.059020938831,6731.375366399475,6435.154732735049,6184.772332402654,5941.782122156971,5686.560994888115,8937.139055535496,5125.951922764994,-2199.7305863642387,];
    //     const z = Array.from({ length: 1000 }, (_,i) => i);
    //     const rhs = rhs_adv_diff(y, dz);


    //     const py = await pydata;
    //     const res = rhs.map((ts, i) => ts - py[i]);
    //     const ssqe = res.reduce((sum, err) => sum + err ** 2);
    //     console.log("Sum of square error:", ssqe);

    //     // Plot
    //     await plotArrs(z, [y.slice(0, nz), y.slice(nz)], {}, { title: { text: "Failing condition :(" } });
    //     await plotArrs(z, [rhs, py], {}, { title: { text: "RoC for sinusoidal concs" } });
    //     await plotArrs(z, [res], {}, { title: { text: "Residuals for sinusoidal RoCs" }});
    // }, 100000);
});